angular.module("ml.retail",["ngRoute","ui.bootstrap","ml.common","ml.search","ml.search.tpls","google-maps"]).config(["$routeProvider","$locationProvider",function(e,n){"use strict";n.html5Mode(!0),e.when("/",{templateUrl:"/home/splash.html",controller:"splashCtrl"}).when("/login",{templateUrl:"/user/login.html",controller:"loginCtrl as ctrl"}).when("/marketer/dashboard",{templateUrl:"/marketer/dashboard.html",controller:"marketerDashboardCtrl"}).when("/analyst/dashboard",{templateUrl:"/analyst/dashboard.html",controller:"analystDashboardCtrl"}).when("/manager/dashboard",{templateUrl:"/manager/dashboard.html",controller:"managerDashboardCtrl"}).when("/loyalty/dashboard",{templateUrl:"/loyalty/dashboard.html",controller:"loyaltyDashboardCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("sample.common",[]).filter("object2Array",function(){"use strict";return function(e){var n=[];for(var t in e)e[t].__key=t,n.push(e[t]);return n}}),function(){"use strict";function e(e,n){return Math.abs(e-n)<1e-6}var n=function(){function n(n){var r=null,a=[],o=[],i=[],l=angular.extend({},t,n),u=this,s=null;this.center=n.center,this.zoom=l.zoom,this.dragging=!1,this.selector=l.container,this.markers=[],this.options=l,this.draw=function(){if(null!==u.center)if(null===r)console.log("creating map"),r=new google.maps.Map(u.selector,u.options),google.maps.event.addListener(r,"dragstart",function(){u.dragging=!0}),google.maps.event.addListener(r,"idle",function(){u.dragging=!1}),google.maps.event.addListener(r,"drag",function(){u.dragging=!0}),google.maps.event.addListener(r,"zoom_changed",function(){u.zoom=r.getZoom(),u.center=r.getCenter()}),google.maps.event.addListener(r,"center_changed",function(){u.center=r.getCenter()}),o.length&&angular.forEach(o,function(e){google.maps.event.addListener(r,e.on,e.handler)});else{google.maps.event.trigger(r,"resize");var n=r.getCenter();e(n.lat(),u.center.lat())&&e(n.lng(),u.center.lng())||r.setCenter(u.center),r.getZoom()!==u.zoom&&r.setZoom(u.zoom)}},this.fit=function(){if(r&&a.length){var e=new google.maps.LatLngBounds;angular.forEach(a,function(n){e.extend(n.getPosition())}),r.fitBounds(e)}},this.on=function(e,n){o.push({on:e,handler:n})},this.getMap=function(){return r},this.addMarker=function(e,n,t,o,i,l,c){function g(e){var n=new google.maps.InfoWindow({content:e});null!==s&&s.close(),n.open(r,d),s=n}if(null===u.findMarker(e,n)){var d=new google.maps.Marker({position:new google.maps.LatLng(e,n),map:r,icon:t});return null!==o&&google.maps.event.addListener(d,"click",function(){"function"==typeof o?o().then(function(e){g(e)}):g(o)}),a.unshift(d),u.markers.unshift({lat:e,lng:n,icon:t,infoWindowContent:o,label:i,url:l,thumbnail:c}),d}},this.findMarker=function(n,t){for(var r=0;r<a.length;r++){var o=a[r].getPosition();if(e(o.lat(),n)&&e(o.lng(),t))return a[r]}return null},this.findMarkerIndex=function(n,t){for(var r=0;r<a.length;r++){var o=a[r].getPosition();if(e(o.lat(),n)&&e(o.lng(),t))return r}return-1},this.addInfoWindow=function(e,n,t){var r=new google.maps.InfoWindow({content:t,position:new google.maps.LatLng(e,n)});return i.push(r),r},this.hasMarker=function(e,n){return null!==u.findMarker(e,n)},this.getMarkerInstances=function(){return a},this.removeMarkers=function(e){var n=this;angular.forEach(e,function(e){var t=e.getPosition(),r=t.lat(),o=t.lng(),i=n.findMarkerIndex(r,o);a.splice(i,1),n.markers.splice(i,1),e.setMap(null)})}}var t={zoom:8,container:null};return n}(),t=angular.module("google-maps",[]);t.directive("googleMap",["$log","$timeout","$filter",function(t,r){return{restrict:"ECA",priority:100,transclude:!0,template:'<div class="angular-google-map" ng-transclude></div>',replace:!1,scope:{options:"=options",markers:"=markers",latitude:"=latitude",longitude:"=longitude",refresh:"&refresh",windows:"=windows",events:"=events"},link:function(a,o,i){if(!angular.isDefined(a.options))return void t.error("angular-google-maps: map options property not set");var l=angular.extend(a.options,{container:o[0]}),u=new n(l);if(u.on("drag",function(){var e=u.center;r(function(){a.$apply(function(){a.options.center.latitude=e.lat(),a.options.center.longitude=e.lng()})})}),u.on("zoom_changed",function(){a.zoom!==u.zoom&&r(function(){a.$apply(function(){a.zoom=u.zoom})})}),u.on("center_changed",function(){var e=u.center;r(function(){a.$apply(function(){u.dragging||(a.options.center.latitude=e.lat(),a.options.center.longitude=e.lng())})})}),angular.isDefined(a.events)){var s=null,c=function(){a.events[s].apply(a,[u,s,arguments])};for(var g in a.events)s=g,a.events.hasOwnProperty(s)&&angular.isFunction(a.events[s])&&u.on(s,c)}if("true"===i.markClick&&!function(){var e=null;u.on("click",function(n){null===e?(e={latitude:n.latLng.lat(),longitude:n.latLng.lng()},a.markers.push(e)):(e.latitude=n.latLng.lat(),e.longitude=n.latLng.lng()),r(function(){a.latitude=e.latitude,a.longitude=e.longitude,a.$apply()})})}(),a.map=u,angular.isUndefined(a.refresh()))u.draw();else{var d=!1;a.$watch("refresh()",function(e,n){!e||d&&n||(u.draw(),d=!0)})}a.$watch("markers",function(n){console.log("watched markers"),r(function(){angular.forEach(n,function(e){u.hasMarker(e.latitude,e.longitude)||u.addMarker(e.latitude,e.longitude,e.icon,e.infoWindow)});var t=[];angular.forEach(u.getMarkerInstances(),function(n){for(var r=n.getPosition(),o=r.lat(),i=r.lng(),l=!1,u=0;u<a.markers.length;u++){var s=a.markers[u];if(e(s.latitude,o)&&e(s.longitude,i)){l=!0;break}}l||t.push(n)}),t.length&&u.removeMarkers(t),"true"===i.fit&&n&&n.length>=1&&u.fit()})},!0),a.$watch("center",function(e,n){e!==n&&(u.dragging||(u.center=new google.maps.LatLng(e.latitude,e.longitude),u.draw()))},!0),a.$watch("zoom",function(e,n){e!==n&&(u.zoom=e,u.draw())})}}}])}(),function(){"use strict";function e(){}var n=angular.module("ml.retail");n.controller("splashCtrl",e)}(),function(){"use strict";function e(e,n){var t=this;t.users={marketer:{label:"Marketer",desc:"Manages marketing and promotional campaigns - including social media"},analyst:{label:"Analyst",desc:"Analyzes sales performance, site performance, etc"},loyalty:{label:"Customer Loyalty Manager",desc:"Maintains customer loyalty via rewards, social campaigns, targetted cross-selling, etc"},manager:{label:"Store Manager",desc:"Manages operations of the retail store"}},n.$watch("ctrl.username",function(e){e?(t.userdesc=t.users[e].desc,t.userlabel=t.users[e].label):t.userdesc=t.userlabel=null})}var n=angular.module("ml.retail");n.controller("loginCtrl",e),e.$inject=["$http","$scope"]}(),function(){"use strict";angular.module("sample.common").factory("MLSampleQueryBuilder",[function(){var e=function(){return 1===arguments.length&&angular.isArray(arguments[0])?{"and-query":{queries:arguments[0]}}:{"and-query":{queries:Array.prototype.slice.call(arguments)}}};return{andQuery:e,boostQuery:function(n,t){return n?{"boost-query":{"matching-query":n,"boosting-query":t}}:{"boost-query":{"matching-query":e(),"boosting-query":t}}},collectionConstraintQuery:function(e,n){return{"collection-constraint-query":{"constraint-name":e,uri:Array.isArray(n)?n:[n]}}},customConstraintQuery:function(e,n){return{"custom-constraint-query":{"constraint-name":e,text:n}}},customGeospatialConstraintQuery:function(e,n,t){return{"custom-constraint-query":{"constraint-name":e,annotation:n,box:t}}},documentQuery:function(e){return{"document-query":{uri:Array.isArray(e)?e:[e]}}},geospatialConstraintQuery:function(e,n){return{"geospatial-constraint-query":{"constraint-name":e,box:n}}},operatorState:function(e,n){return{"operator-state":{"operator-name":e,"state-name":n}}},orQuery:function(){return 1===arguments.length&&angular.isArray(arguments[0])?{"or-query":{queries:arguments[0]}}:{"or-query":{queries:Array.prototype.slice.call(arguments)}}},propertiesQuery:function(e){return{"properties-query":e}},rangeConstraintQuery:function(e,n,t,r){return r||(r=[]),n||(n="EQ"),{"range-constraint-query":{"constraint-name":e,"range-operator":n,value:t,"range-option":r}}},structuredQuery:function(){return 1===arguments.length&&angular.isArray(arguments[0])?{query:{queries:arguments[0]}}:{query:{queries:Array.prototype.slice.call(arguments)}}},termQuery:function(e,n){return n?{"term-query":{text:e,weight:n}}:{"term-query":{text:e}}},textQuery:function(e){return{qtext:e}}}}])}();