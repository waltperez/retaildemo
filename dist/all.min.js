"use strict";angular.module("ml.retail",["ngRoute","ui.bootstrap","ml.common","ml.search","ml.search.tpls","google-maps"]).controller("appCtrl",["userService","$scope","$location",function(e,n,t){var r=this;r.logout=function(){console.log("logging out"),e.logout()},n.$watch(function(){return e.user},function(e){e?r.username=e.username:(r.username=null,t.path("/").search(""))})}]).config(["$routeProvider","$locationProvider",function(e,n){n.html5Mode(!0),e.when("/splash",{templateUrl:"/home/splash.html",controller:"splashCtrl as splashCtrl"}).when("/login",{templateUrl:"/user/login.html",controller:"loginCtrl as ctrl"}).when("/marketer/dashboard",{templateUrl:"/marketer/dashboard.html",controller:"marketerCtrl as markterCtrl"}).when("/analyst/dashboard",{templateUrl:"/analyst/dashboard.html",controller:"analystDashboardCtrl"}).when("/manager/dashboard",{templateUrl:"/manager/dashboard.html",controller:"managerDashboardCtrl"}).when("/loyalty/dashboard",{templateUrl:"/loyalty/dashboard.html",controller:"loyaltyDashboardCtrl"}).when("/consumer/home",{templateUrl:"/consumer/consumer_home.html",controller:"consumerHomeCtrl as consumerCtrl"}).otherwise({redirectTo:"/consumer/home"})}]),angular.module("sample.common",[]).filter("object2Array",function(){return function(e){var n=[];for(var t in e)e[t].__key=t,n.push(e[t]);return n}}),function(){function e(e,n){return Math.abs(e-n)<1e-6}var n=function(){function n(n){var r=null,a=[],o=[],i=[],l=angular.extend({},t,n),s=this,u=null;this.center=n.center,this.zoom=l.zoom,this.dragging=!1,this.selector=l.container,this.markers=[],this.options=l,this.draw=function(){if(null!==s.center)if(null===r)console.log("creating map"),r=new google.maps.Map(s.selector,s.options),google.maps.event.addListener(r,"dragstart",function(){s.dragging=!0}),google.maps.event.addListener(r,"idle",function(){s.dragging=!1}),google.maps.event.addListener(r,"drag",function(){s.dragging=!0}),google.maps.event.addListener(r,"zoom_changed",function(){s.zoom=r.getZoom(),s.center=r.getCenter()}),google.maps.event.addListener(r,"center_changed",function(){s.center=r.getCenter()}),o.length&&angular.forEach(o,function(e){google.maps.event.addListener(r,e.on,e.handler)});else{google.maps.event.trigger(r,"resize");var n=r.getCenter();e(n.lat(),s.center.lat())&&e(n.lng(),s.center.lng())||r.setCenter(s.center),r.getZoom()!==s.zoom&&r.setZoom(s.zoom)}},this.fit=function(){if(r&&a.length){var e=new google.maps.LatLngBounds;angular.forEach(a,function(n){e.extend(n.getPosition())}),r.fitBounds(e)}},this.on=function(e,n){o.push({on:e,handler:n})},this.getMap=function(){return r},this.addMarker=function(e,n,t,o,i,l,c){function g(e){var n=new google.maps.InfoWindow({content:e});null!==u&&u.close(),n.open(r,m),u=n}if(null===s.findMarker(e,n)){var m=new google.maps.Marker({position:new google.maps.LatLng(e,n),map:r,icon:t});return null!==o&&google.maps.event.addListener(m,"click",function(){"function"==typeof o?o().then(function(e){g(e)}):g(o)}),a.unshift(m),s.markers.unshift({lat:e,lng:n,icon:t,infoWindowContent:o,label:i,url:l,thumbnail:c}),m}},this.findMarker=function(n,t){for(var r=0;r<a.length;r++){var o=a[r].getPosition();if(e(o.lat(),n)&&e(o.lng(),t))return a[r]}return null},this.findMarkerIndex=function(n,t){for(var r=0;r<a.length;r++){var o=a[r].getPosition();if(e(o.lat(),n)&&e(o.lng(),t))return r}return-1},this.addInfoWindow=function(e,n,t){var r=new google.maps.InfoWindow({content:t,position:new google.maps.LatLng(e,n)});return i.push(r),r},this.hasMarker=function(e,n){return null!==s.findMarker(e,n)},this.getMarkerInstances=function(){return a},this.removeMarkers=function(e){var n=this;angular.forEach(e,function(e){var t=e.getPosition(),r=t.lat(),o=t.lng(),i=n.findMarkerIndex(r,o);a.splice(i,1),n.markers.splice(i,1),e.setMap(null)})}}var t={zoom:8,container:null};return n}(),t=angular.module("google-maps",[]);t.directive("googleMap",["$log","$timeout","$filter",function(t,r){return{restrict:"ECA",priority:100,transclude:!0,template:'<div class="angular-google-map" ng-transclude></div>',replace:!1,scope:{options:"=options",markers:"=markers",latitude:"=latitude",longitude:"=longitude",refresh:"&refresh",windows:"=windows",events:"=events"},link:function(a,o,i){if(!angular.isDefined(a.options))return void t.error("angular-google-maps: map options property not set");var l=angular.extend(a.options,{container:o[0]}),s=new n(l);if(s.on("drag",function(){var e=s.center;r(function(){a.$apply(function(){a.options.center.latitude=e.lat(),a.options.center.longitude=e.lng()})})}),s.on("zoom_changed",function(){a.zoom!==s.zoom&&r(function(){a.$apply(function(){a.zoom=s.zoom})})}),s.on("center_changed",function(){var e=s.center;r(function(){a.$apply(function(){s.dragging||(a.options.center.latitude=e.lat(),a.options.center.longitude=e.lng())})})}),angular.isDefined(a.events)){var u=null,c=function(){a.events[u].apply(a,[s,u,arguments])};for(var g in a.events)u=g,a.events.hasOwnProperty(u)&&angular.isFunction(a.events[u])&&s.on(u,c)}if("true"===i.markClick&&!function(){var e=null;s.on("click",function(n){null===e?(e={latitude:n.latLng.lat(),longitude:n.latLng.lng()},a.markers.push(e)):(e.latitude=n.latLng.lat(),e.longitude=n.latLng.lng()),r(function(){a.latitude=e.latitude,a.longitude=e.longitude,a.$apply()})})}(),a.map=s,angular.isUndefined(a.refresh()))s.draw();else{var m=!1;a.$watch("refresh()",function(e,n){!e||m&&n||(s.draw(),m=!0)})}a.$watch("markers",function(n){console.log("watched markers"),r(function(){angular.forEach(n,function(e){s.hasMarker(e.latitude,e.longitude)||s.addMarker(e.latitude,e.longitude,e.icon,e.infoWindow)});var t=[];angular.forEach(s.getMarkerInstances(),function(n){for(var r=n.getPosition(),o=r.lat(),i=r.lng(),l=!1,s=0;s<a.markers.length;s++){var u=a.markers[s];if(e(u.latitude,o)&&e(u.longitude,i)){l=!0;break}}l||t.push(n)}),t.length&&s.removeMarkers(t),"true"===i.fit&&n&&n.length>=1&&s.fit()})},!0),a.$watch("center",function(e,n){e!==n&&(s.dragging||(s.center=new google.maps.LatLng(e.latitude,e.longitude),s.draw()))},!0),a.$watch("zoom",function(e,n){e!==n&&(s.zoom=e,s.draw())})}}}])}(),function(){function e(e,n){var t=this;t.isSearching=e.mlSearch,n.$watch(function(){return e.isSearching},function(e){t.isSearching=e})}var n=angular.module("ml.retail");n.controller("consumerHomeCtrl",e),e.$injector=["consumerSearchService","$scope"]}(),function(){function e(e){var n={};return n.mlSearch=e.newContext({}),n.fromParams=function(){n.mlSearch.fromParams().then(n.parseResults)},n.parseResults=function(e){n.isSearching=!1,n.results=e,n.qtext=n.mlSearch.getText(),n.page=n.mlSearch.getPage()},n.searchText=function(e){n.startSearch(),n.mlSearch.setText(e).setPage(1).search().then(n.parseResults)},n.startSearch=function(){n.isSearching=!0},n}var n=angular.module("ml.retail");n.factory("consumerSearchService",e),e.$inject=["MLSearchFactory"]}(),function(){function e(e){return{restrict:"E",replace:!0,link:function(n){n.searchText="",n.doSearch=function(){n.searchForm.$valid?e.searchText(n.searchText):console.log("invalid")}},templateUrl:"/consumer/consumer_subnav.html"}}var n=angular.module("ml.retail");n.directive("consumerSubnav",e),e.$injector=["consumerSearchService"]}(),function(){function e(){var e=this;e.chartOptions={chart:{type:"column"},title:{text:"Stacked column chart"},xAxis:{categories:["Apples","Oranges","Pears","Grapes","Bananas"]},yAxis:{min:0,title:{text:"Total fruit consumption"}},tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.percentage:.0f}%)<br/>',shared:!0},plotOptions:{column:{stacking:"percent"}},series:[{name:"John",data:[5,3,4,7,2]},{name:"Jane",data:[2,2,3,2,1]},{name:"Joe",data:[3,4,4,2,5]}]},console.log("chart options",e.chartOptions)}function n(){return{restrict:"A",scope:{chartOptions:"=",chartData:"="},link:function(e,n){console.log("splash chart",e.chartOptions),e.chart=n.highcharts(e.chartOptions)}}}var t=angular.module("ml.retail");t.controller("splashCtrl",e).directive("splashChart",n),e.$inject=["$scope"]}(),function(){function e(){}var n=angular.module("ml.retail");n.controller("marketerCtrl",e)}(),function(){function e(e,n,t){var r=this;r.users={marketer:{label:"Marketer",desc:"Manages marketing and promotional campaigns - including social media",name:"John Marketer"},analyst:{label:"Analyst",desc:"Analyzes sales performance, site performance, etc",name:"Susie Analyst"},loyalty:{label:"Customer Loyalty Manager",desc:"Maintains customer loyalty via rewards, social campaigns, targetted cross-selling, etc",name:"Tom Loyalty"},manager:{label:"Store Manager",desc:"Manages operations of the retail store",name:"Jane Boss"}},n.$watch("ctrl.username",function(e){e?(r.userdesc=r.users[e].desc,r.userlabel=r.users[e].label):r.userdesc=r.userlabel=null}),r.login=function(){e.login(r.username,r.users[r.username].name),t.path("/"+r.username+"/dashboard").search("")}}var n=angular.module("ml.retail");n.controller("loginCtrl",e),e.$inject=["userService","$scope","$location"]}(),function(){function e(){var e={};return e.user=null,e.login=function(n,t){e.user={role:n,username:t}},e.logout=function(){e.user=null},e}var n=angular.module("ml.retail");n.service("userService",e),e.$inject=["$http","$rootScope"]}(),function(){angular.module("sample.common").factory("MLSampleQueryBuilder",[function(){var e=function(){return 1===arguments.length&&angular.isArray(arguments[0])?{"and-query":{queries:arguments[0]}}:{"and-query":{queries:Array.prototype.slice.call(arguments)}}};return{andQuery:e,boostQuery:function(n,t){return n?{"boost-query":{"matching-query":n,"boosting-query":t}}:{"boost-query":{"matching-query":e(),"boosting-query":t}}},collectionConstraintQuery:function(e,n){return{"collection-constraint-query":{"constraint-name":e,uri:Array.isArray(n)?n:[n]}}},customConstraintQuery:function(e,n){return{"custom-constraint-query":{"constraint-name":e,text:n}}},customGeospatialConstraintQuery:function(e,n,t){return{"custom-constraint-query":{"constraint-name":e,annotation:n,box:t}}},documentQuery:function(e){return{"document-query":{uri:Array.isArray(e)?e:[e]}}},geospatialConstraintQuery:function(e,n){return{"geospatial-constraint-query":{"constraint-name":e,box:n}}},operatorState:function(e,n){return{"operator-state":{"operator-name":e,"state-name":n}}},orQuery:function(){return 1===arguments.length&&angular.isArray(arguments[0])?{"or-query":{queries:arguments[0]}}:{"or-query":{queries:Array.prototype.slice.call(arguments)}}},propertiesQuery:function(e){return{"properties-query":e}},rangeConstraintQuery:function(e,n,t,r){return r||(r=[]),n||(n="EQ"),{"range-constraint-query":{"constraint-name":e,"range-operator":n,value:t,"range-option":r}}},structuredQuery:function(){return 1===arguments.length&&angular.isArray(arguments[0])?{query:{queries:arguments[0]}}:{query:{queries:Array.prototype.slice.call(arguments)}}},termQuery:function(e,n){return n?{"term-query":{text:e,weight:n}}:{"term-query":{text:e}}},textQuery:function(e){return{qtext:e}}}}])}();