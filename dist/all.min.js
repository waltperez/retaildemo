angular.module("ml.retail",["ngRoute","ui.bootstrap","ml.common","ml.search","ml.search.tpls","google-maps"]).config(["$routeProvider","$locationProvider",function(e,t){"use strict";t.html5Mode(!0),e.when("/",{templateUrl:"/home/splash.html",controller:"splashCtrl as splashCtrl"}).when("/login",{templateUrl:"/user/login.html",controller:"loginCtrl as ctrl"}).when("/marketer/dashboard",{templateUrl:"/marketer/dashboard.html",controller:"marketerDashboardCtrl"}).when("/analyst/dashboard",{templateUrl:"/analyst/dashboard.html",controller:"analystDashboardCtrl"}).when("/manager/dashboard",{templateUrl:"/manager/dashboard.html",controller:"managerDashboardCtrl"}).when("/loyalty/dashboard",{templateUrl:"/loyalty/dashboard.html",controller:"loyaltyDashboardCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("sample.common",[]).filter("object2Array",function(){"use strict";return function(e){var t=[];for(var n in e)e[n].__key=n,t.push(e[n]);return t}}),function(){"use strict";function e(e,t){return Math.abs(e-t)<1e-6}var t=function(){function t(t){var r=null,a=[],o=[],i=[],l=angular.extend({},n,t),s=this,u=null;this.center=t.center,this.zoom=l.zoom,this.dragging=!1,this.selector=l.container,this.markers=[],this.options=l,this.draw=function(){if(null!==s.center)if(null===r)console.log("creating map"),r=new google.maps.Map(s.selector,s.options),google.maps.event.addListener(r,"dragstart",function(){s.dragging=!0}),google.maps.event.addListener(r,"idle",function(){s.dragging=!1}),google.maps.event.addListener(r,"drag",function(){s.dragging=!0}),google.maps.event.addListener(r,"zoom_changed",function(){s.zoom=r.getZoom(),s.center=r.getCenter()}),google.maps.event.addListener(r,"center_changed",function(){s.center=r.getCenter()}),o.length&&angular.forEach(o,function(e){google.maps.event.addListener(r,e.on,e.handler)});else{google.maps.event.trigger(r,"resize");var t=r.getCenter();e(t.lat(),s.center.lat())&&e(t.lng(),s.center.lng())||r.setCenter(s.center),r.getZoom()!==s.zoom&&r.setZoom(s.zoom)}},this.fit=function(){if(r&&a.length){var e=new google.maps.LatLngBounds;angular.forEach(a,function(t){e.extend(t.getPosition())}),r.fitBounds(e)}},this.on=function(e,t){o.push({on:e,handler:t})},this.getMap=function(){return r},this.addMarker=function(e,t,n,o,i,l,c){function g(e){var t=new google.maps.InfoWindow({content:e});null!==u&&u.close(),t.open(r,m),u=t}if(null===s.findMarker(e,t)){var m=new google.maps.Marker({position:new google.maps.LatLng(e,t),map:r,icon:n});return null!==o&&google.maps.event.addListener(m,"click",function(){"function"==typeof o?o().then(function(e){g(e)}):g(o)}),a.unshift(m),s.markers.unshift({lat:e,lng:t,icon:n,infoWindowContent:o,label:i,url:l,thumbnail:c}),m}},this.findMarker=function(t,n){for(var r=0;r<a.length;r++){var o=a[r].getPosition();if(e(o.lat(),t)&&e(o.lng(),n))return a[r]}return null},this.findMarkerIndex=function(t,n){for(var r=0;r<a.length;r++){var o=a[r].getPosition();if(e(o.lat(),t)&&e(o.lng(),n))return r}return-1},this.addInfoWindow=function(e,t,n){var r=new google.maps.InfoWindow({content:n,position:new google.maps.LatLng(e,t)});return i.push(r),r},this.hasMarker=function(e,t){return null!==s.findMarker(e,t)},this.getMarkerInstances=function(){return a},this.removeMarkers=function(e){var t=this;angular.forEach(e,function(e){var n=e.getPosition(),r=n.lat(),o=n.lng(),i=t.findMarkerIndex(r,o);a.splice(i,1),t.markers.splice(i,1),e.setMap(null)})}}var n={zoom:8,container:null};return t}(),n=angular.module("google-maps",[]);n.directive("googleMap",["$log","$timeout","$filter",function(n,r){return{restrict:"ECA",priority:100,transclude:!0,template:'<div class="angular-google-map" ng-transclude></div>',replace:!1,scope:{options:"=options",markers:"=markers",latitude:"=latitude",longitude:"=longitude",refresh:"&refresh",windows:"=windows",events:"=events"},link:function(a,o,i){if(!angular.isDefined(a.options))return void n.error("angular-google-maps: map options property not set");var l=angular.extend(a.options,{container:o[0]}),s=new t(l);if(s.on("drag",function(){var e=s.center;r(function(){a.$apply(function(){a.options.center.latitude=e.lat(),a.options.center.longitude=e.lng()})})}),s.on("zoom_changed",function(){a.zoom!==s.zoom&&r(function(){a.$apply(function(){a.zoom=s.zoom})})}),s.on("center_changed",function(){var e=s.center;r(function(){a.$apply(function(){s.dragging||(a.options.center.latitude=e.lat(),a.options.center.longitude=e.lng())})})}),angular.isDefined(a.events)){var u=null,c=function(){a.events[u].apply(a,[s,u,arguments])};for(var g in a.events)u=g,a.events.hasOwnProperty(u)&&angular.isFunction(a.events[u])&&s.on(u,c)}if("true"===i.markClick&&!function(){var e=null;s.on("click",function(t){null===e?(e={latitude:t.latLng.lat(),longitude:t.latLng.lng()},a.markers.push(e)):(e.latitude=t.latLng.lat(),e.longitude=t.latLng.lng()),r(function(){a.latitude=e.latitude,a.longitude=e.longitude,a.$apply()})})}(),a.map=s,angular.isUndefined(a.refresh()))s.draw();else{var m=!1;a.$watch("refresh()",function(e,t){!e||m&&t||(s.draw(),m=!0)})}a.$watch("markers",function(t){console.log("watched markers"),r(function(){angular.forEach(t,function(e){s.hasMarker(e.latitude,e.longitude)||s.addMarker(e.latitude,e.longitude,e.icon,e.infoWindow)});var n=[];angular.forEach(s.getMarkerInstances(),function(t){for(var r=t.getPosition(),o=r.lat(),i=r.lng(),l=!1,s=0;s<a.markers.length;s++){var u=a.markers[s];if(e(u.latitude,o)&&e(u.longitude,i)){l=!0;break}}l||n.push(t)}),n.length&&s.removeMarkers(n),"true"===i.fit&&t&&t.length>=1&&s.fit()})},!0),a.$watch("center",function(e,t){e!==t&&(s.dragging||(s.center=new google.maps.LatLng(e.latitude,e.longitude),s.draw()))},!0),a.$watch("zoom",function(e,t){e!==t&&(s.zoom=e,s.draw())})}}}])}(),function(){"use strict";function e(){var e=this;e.chartOptions={chart:{type:"column"},title:{text:"Stacked column chart"},xAxis:{categories:["Apples","Oranges","Pears","Grapes","Bananas"]},yAxis:{min:0,title:{text:"Total fruit consumption"}},tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.percentage:.0f}%)<br/>',shared:!0},plotOptions:{column:{stacking:"percent"}},series:[{name:"John",data:[5,3,4,7,2]},{name:"Jane",data:[2,2,3,2,1]},{name:"Joe",data:[3,4,4,2,5]}]},console.log("chart options",e.chartOptions)}function t(){return{restrict:"A",scope:{chartOptions:"=",chartData:"="},link:function(e,t){console.log("splash chart",e.chartOptions),e.chart=t.highcharts(e.chartOptions)}}}var n=angular.module("ml.retail");n.controller("splashCtrl",e).directive("splashChart",t),e.$inject=["$scope"]}(),function(){"use strict";function e(e,t){var n=this;n.users={marketer:{label:"Marketer",desc:"Manages marketing and promotional campaigns - including social media"},analyst:{label:"Analyst",desc:"Analyzes sales performance, site performance, etc"},loyalty:{label:"Customer Loyalty Manager",desc:"Maintains customer loyalty via rewards, social campaigns, targetted cross-selling, etc"},manager:{label:"Store Manager",desc:"Manages operations of the retail store"}},t.$watch("ctrl.username",function(e){e?(n.userdesc=n.users[e].desc,n.userlabel=n.users[e].label):n.userdesc=n.userlabel=null})}var t=angular.module("ml.retail");t.controller("loginCtrl",e),e.$inject=["$http","$scope"]}(),function(){"use strict";angular.module("sample.common").factory("MLSampleQueryBuilder",[function(){var e=function(){return 1===arguments.length&&angular.isArray(arguments[0])?{"and-query":{queries:arguments[0]}}:{"and-query":{queries:Array.prototype.slice.call(arguments)}}};return{andQuery:e,boostQuery:function(t,n){return t?{"boost-query":{"matching-query":t,"boosting-query":n}}:{"boost-query":{"matching-query":e(),"boosting-query":n}}},collectionConstraintQuery:function(e,t){return{"collection-constraint-query":{"constraint-name":e,uri:Array.isArray(t)?t:[t]}}},customConstraintQuery:function(e,t){return{"custom-constraint-query":{"constraint-name":e,text:t}}},customGeospatialConstraintQuery:function(e,t,n){return{"custom-constraint-query":{"constraint-name":e,annotation:t,box:n}}},documentQuery:function(e){return{"document-query":{uri:Array.isArray(e)?e:[e]}}},geospatialConstraintQuery:function(e,t){return{"geospatial-constraint-query":{"constraint-name":e,box:t}}},operatorState:function(e,t){return{"operator-state":{"operator-name":e,"state-name":t}}},orQuery:function(){return 1===arguments.length&&angular.isArray(arguments[0])?{"or-query":{queries:arguments[0]}}:{"or-query":{queries:Array.prototype.slice.call(arguments)}}},propertiesQuery:function(e){return{"properties-query":e}},rangeConstraintQuery:function(e,t,n,r){return r||(r=[]),t||(t="EQ"),{"range-constraint-query":{"constraint-name":e,"range-operator":t,value:n,"range-option":r}}},structuredQuery:function(){return 1===arguments.length&&angular.isArray(arguments[0])?{query:{queries:arguments[0]}}:{query:{queries:Array.prototype.slice.call(arguments)}}},termQuery:function(e,t){return t?{"term-query":{text:e,weight:t}}:{"term-query":{text:e}}},textQuery:function(e){return{qtext:e}}}}])}();